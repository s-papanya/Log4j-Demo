<!doctype html>
<html lang="th" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>อัปโหลดรูปสินค้า (.zip)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;margin:0;background:#0f172a;color:#e5e7eb}
    .wrap{max-width:920px;margin:32px auto;padding:20px}
    .card{background:#111827;border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:20px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0b1222;color:#e5e7eb}
    .btn{padding:10px 14px;border:0;border-radius:10px;background:#22c55e;color:#071b12;font-weight:700;cursor:pointer}
    .muted{color:#9ca3af}
    .progress{height:8px;background:#0b1222;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden;margin-top:12px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#60a5fa,#93c5fd)}
    pre{background:#0b1222;border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:10px;white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>อัปโหลดรูปสินค้า (ZIP เท่านั้น)</h2>
      <p class="muted">เลือกรูปแบบ .zip ระบบจะแตกไฟล์ เก็บรูป และสร้าง thumbnail ให้</p>

      <div class="row" style="margin-bottom:10px">
        <label>
          <div class="muted">Product ID</div>
          <input class="input" id="productId" th:value="${productId}">
        </label>
        <label>
          <div class="muted">เลือกไฟล์ .zip</div>
          <input class="input" type="file" id="zipInput" accept=".zip">
        </label>
      </div>

      <button id="uploadBtn" class="btn">อัปโหลด</button>
      <div class="progress"><div id="bar" class="bar"></div></div>

      <h4>ผลลัพธ์</h4>
      <pre id="status" class="muted">ยังไม่มีการอัปโหลด</pre>
    </div>
  </div>

<script>
(function(){
  var zipInput = document.getElementById('zipInput');
  var uploadBtn = document.getElementById('uploadBtn');
  var productIdEl = document.getElementById('productId');
  var bar = document.getElementById('bar');
  var statusBox = document.getElementById('status');

  function setProgress(p){ bar.style.width = Math.max(0,Math.min(100,p)) + '%'; }
  function setStatus(t){ statusBox.textContent = t; }

  uploadBtn.addEventListener('click', function(){
    var file = zipInput.files[0];
    var productId = (productIdEl.value || '').trim() || '123';

    if(!file){ setStatus('กรุณาเลือกไฟล์ .zip'); return; }
    if(!/\.zip$/i.test(file.name)){ setStatus('รองรับเฉพาะไฟล์ .zip'); return; }

    var form = new FormData();
    form.append('file', file);

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/products/' + encodeURIComponent(productId) + '/images/upload');

    xhr.upload.onprogress = function(e){
      if(e.lengthComputable){ setProgress(e.loaded / e.total * 100); }
    };
    xhr.onloadstart = function(){ setProgress(0); setStatus('กำลังอัปโหลด...'); uploadBtn.disabled = true; };
    xhr.onerror = function(){ setStatus('Network error'); uploadBtn.disabled = false; };
    xhr.onload = function(){
      uploadBtn.disabled = false;
      setProgress(100);
      try{
        var json = JSON.parse(xhr.responseText || '{}');
        if(xhr.status >= 200 && xhr.status < 300){
          setStatus('สำเร็จ: ' + JSON.stringify(json, null, 2));
        }else{
          setStatus('ผิดพลาด: ' + (json.error || ('HTTP ' + xhr.status)));
        }
      }catch(e){
        setStatus('ผิดพลาด: อ่านผลลัพธ์ไม่ได้');
      }
    };

    xhr.send(form);
  });
})();
</script>
</body>
</html>
